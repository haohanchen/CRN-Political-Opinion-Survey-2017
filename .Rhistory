# China map
cn_map = readShapePoly('../Data/map/bou2_4p.shp')
knitr::opts_chunk$set(# fig.width=12, fig.height=8,
fig.path='Figs/',
echo=FALSE, warning=FALSE, message=FALSE, results = 'hide')
Sys.setlocale("LC_ALL", locale="chs")
knitr::opts_chunk$set(# fig.width=12, fig.height=8,
fig.path='figs/',
echo=FALSE, warning=FALSE, message=FALSE, results = 'hide')
Sys.setlocale("LC_ALL", locale="chs")
knitr::opts_chunk$set(# fig.width=12, fig.height=8,
fig.path='figs/',
echo=FALSE, warning=FALSE, message=FALSE, results = 'hide')
Sys.setlocale("LC_ALL", locale="chs")
d = read.csv("../Data/Data.csv", sep = ",", stringsAsFactors = F, skip = 1, fileEncoding = "UTF-8-BOM")
d$place_residence[which(d$place_residence == "new jeresy")] = "New Jersey"
codebook = read.csv("codebook.csv", sep = ",", stringsAsFactors = F, fileEncoding = "UTF-8-BOM")
# libriries
library(ggplot2)
library(ggmap)
library(maps)
library(mapdata)
library(rgeos)
library(rgdal)
library(maptools)
library(fiftystater)
library(knitr)
library(stargazer)
library(PerformanceAnalytics)
library(gmodels)
library(vcdExtra)
source("http://pcwww.liv.ac.uk/~william/R/crosstab.r")
# US map
data("fifty_states")
# China map
cn_map = readShapePoly('../Data/map/bou2_4p.shp')
d = read.csv("../Data/Data.csv", sep = ",", stringsAsFactors = F, skip = 1, fileEncoding = "UTF-8-BOM")
# States of residence
d$place_residence = tolower(d$place_residence)
# prop.table(table(d$place_residence))
# Map of sample: USA
sum_residence = as.data.frame(table(d$place_residence))
names(sum_residence) = c("state", "n_resp")
# sum_residence[!(sum_residence$state %in% fifty_states$id),]
sum_residence = merge(sum_residence, data.frame(state = unique(fifty_states$id)), by = "state", all.y = T)
ggplot(sum_residence, aes(map_id = state)) + geom_map(aes(fill = n_resp), color = "white", map = fifty_states)+
expand_limits(x = fifty_states$long, y = fifty_states$lat) +
coord_map() +
scale_x_continuous(breaks = NULL) +
scale_y_continuous(breaks = NULL) + scale_fill_gradient(high = "darkblue",low = "lightblue", na.value = "gray") +
labs(x = "", y = "") +
theme(legend.position = "bottom", panel.background = element_blank(), legend.title=element_blank()) +
ggtitle("受访者所在州分布（单位：人）")
# Map of sample: China
cn_map2 = fortify(cn_map, region = "NAME")
cn_prov_list = as.character(unique(d$place_birth))
cn_prov_list = cn_prov_list[order(cn_prov_list)]
cn_prov_list = data.frame(place_birth = cn_prov_list, place_birth_r = c(NA, substr(cn_prov_list[2:29], 2, 99), "台湾省", "香港特别行政区", NA))
# cn_prov_list
d = merge(d, cn_prov_list, by = "place_birth")
sum_birth_place = as.data.frame(table(d$place_birth_r, useNA = "no"))
names(sum_birth_place) = c("cn_prov", "count")
sum_birth_place = merge(sum_birth_place, data.frame(cn_prov = unique(cn_map2$id)), by = "cn_prov", all.y = T)
ggplot(sum_birth_place, aes(map_id = cn_prov)) + geom_map(aes(fill = count), color = "white", map = cn_map2)+
expand_limits(x = cn_map2$long, y = cn_map2$lat) +
coord_map() +
scale_x_continuous(breaks = NULL) +
scale_y_continuous(breaks = NULL) + scale_fill_gradient(high = "darkblue",low = "lightblue", na.value = "gray") +
labs(x = "", y = "") +
theme(legend.position = "bottom", panel.background = element_blank(), legend.title=element_blank()) +
ggtitle("受访者家乡分布（单位：人）")
# Age
# table(d$yr_birth)
d$yr_birth[d$yr_birth == "1970及之前"] = 1970
d$yr_birth = as.numeric(d$yr_birth)
d$age = 2017 - d$yr_birth
cat("年龄：")
summary(2017 - d$yr_birth)
ggplot(d, aes(2017 - yr_birth)) + geom_histogram(bins = 15) + ylab("人数") + xlab("年龄") + ggtitle("受访者年龄")
# number of years in north america
# table(d$yr_arrive_am)
d$yr_arrive_am[d$yr_arrive_am == "1990年以前"] = 1990
d$yr_arrive_am = as.numeric(d$yr_arrive_am)
# age arrive at US
cat("在北美居住年限")
summary(d$yr_arrive_am - d$yr_birth)
ggplot(d, aes(y = 2017 - yr_arrive_am, x = 2017 - yr_birth)) + geom_jitter(alpha = 0.5) + ylab("在北美居住年限") + xlab("受访者年龄") +
ggtitle("年龄和北美居住年限")
cat("到达北美的年龄")
summary(2017 - d$yr_arrive_am)
ggplot(d, aes(2017 - yr_arrive_am)) + geom_histogram(bins = 15) + ylab("人数") + xlab("年龄") + ggtitle("在北美居住年限")
# Biological and Psychological gender
round(prop.table(table(心理性别 = d$gender_psy, 生理性别= d$gender_bio)), 2)
# Gender and Sex orientation
round(prop.table(table(心理性别 = d$gender_psy, 性取向= d$sex_orien)), 2)
kable(round(prop.table(table(情感婚姻 = d$marriage, 小孩 = d$child)), 2))
edu_first_am = factor(d$edu_first_am, levels = unique(d$edu_first_am)[c(4,7,5,3,2,1,6)])
levels(edu_first_am) = c("小学", "初中", "高中/高职", "本科", "研究生", "博士", NA)
ggplot(as.data.frame(prop.table(table(edu_first_am))), aes(x = edu_first_am, y = Freq)) + geom_bar(stat = "identity")
income = factor(d$income, levels = sort(unique(d$income))[c(1,2,11,13:19,3:10,12)])
ggplot(as.data.frame(prop.table(table(income))), aes(x = income, y = Freq)) + geom_bar(stat = "identity")  + coord_flip()
income_n = income
levels(income_n) = c(seq(5000, 175000, 10000), 205000)
income_n = as.numeric(as.character(income_n))
d$income_n = income_n
qplot(income_n, geom = "histogram", bins = 12)
# 用了多少时间在媒体上
table(d$media_time)
# 花在政治媒体时间上的比例。绝大部分在政治类媒体上花的时间并不多
table(d$media_time.1)
prop.table(table(d$media_time.1))
# 花在中文媒体时间上的比例
# 大部分人主要消费的还是中文媒体
round(prop.table(table(d$media_time_cn)), 2)
# 比起关心中国政治，更多人关心美国政治
round(prop.table(table(d$interest_politics_cn)), 2)
round(prop.table(table(d$interest_politics_us)), 2)
# 党派身份认同。中间选民比例最大
round(prop.table(table(d$party_id)), 2)
# 党派身份和专业。STEM更多共和党支持者
round(prop.table(table(d$party_id, d$edu_stem), margin = 2), 2)
# 党派身份和收入
round(prop.table(table(d$party_id, d$income), margin = 2), 2)
table(d$edu_stem)
# 党派身份和学生。学生更少共和党支持者
round(prop.table(table(d$party_id, d$student), margin = 2), 2)
# 党派身份和研究工作者。没什么关系
round(prop.table(table(d$party_id, d$job_univ_research), margin = 2), 2)
# 候选人支持。
# 初选的桑德斯支持者和希拉里支持者一样多，大约三成。紧接着是川普，拿到了13%的支持
# 大选时希拉里的支持率有六成，川普两成，而有两成的人选择不投票。这些人是谁呢（下面）
# 不管是初选还是大选，弃权率都是比较高的。大概都有两成的人。
d$vote_primary16 = factor(d$vote_primary16)
levels(d$vote_primary16) = c("Sanders", "Clinton", "Trump", "Kasich", "Rubio", "Cruz", "不投票", "其他")
d$vote_gen16 = factor(d$vote_gen16)
levels(d$vote_gen16) = c("Trump", "Clinton", "不投票")
round(prop.table(table(d$vote_primary16)), 2)
round(prop.table(table(d$vote_gen16)), 2)
# 两轮投票意愿的tab.
#
# 首轮桑德斯支持者中只有78%在大选会投给希拉里，有16%会弃权， 6%会投给希拉里。
# 大选弃权的（这两成）人是谁呢？我们可以看到大概两成多是首轮支持桑德斯的人，七成是首轮就不投票的人。
round(prop.table(table(d$vote_primary16, d$vote_gen16)), 2)
round(prop.table(table(d$vote_primary16, d$vote_gen16), 1), 2)
round(prop.table(table(d$vote_primary16, d$vote_gen16), 2), 2)
tab_vote_2r_full = xtabs(~ vote_primary16 + vote_gen16, data = d)
tab_vote_2r_cut = xtabs(~ vote_primary16 + vote_gen16, data = d, exclude = c("Kasich", "Rubio", "Cruz", "其他"))
tab_vote_2r_pid = xtabs(~ party_id + vote_primary16 + vote_gen16, data = d)
